<section id="c_03">
    <h2 id="imploverview">Implementation Overview</h2>
    <p>
        The preprocessor requires LXML to be installed.
    </p>
    <p>
        The preprocessor assumes that heading tags (h2, h3, etc.)
        <em>really are</em> used as headings, and not e.g. as a shorthand
        for "bigger text".
        
        It <em>does not</em> allow for skipping headings e.g. h4 after an h2 without
        an intervening h3.

        
        Other than what was just described, it does not validate markup 
        any further than LXML does.
    </p>

    <h3 id="cmds">Commands</h3>
    <p>
        Every command in a HTML follows this format: <code>{{ verbatim: {{ (command): (arguments) }} }}</code> If there is no arguments,
        the format is simply <code>{{ verbatim: {{ (command): }} }}</code>.
    </p>

    <h4 id="corecmds">Core commands</h4>
    <p>
        The list of core commands is as follows:
    </p>
    <dl class="commands">
        <div>
            <dt><code>table of contents</code></dt>
            <dd>
                <div class="dddesc">
                    Places a table of contents in the page from every heading tag
                    <strong>except</strong> h1, because an h1 is assumed to be used for
                    the title of the document.
        
                    It takes no arguments.
                </div>
                <div class="arguments">
                    <b>Arguments</b>: None
                </div>
                <div class="example">
                    Example: <code>{{ verbatim: {{ table of contents: }}}}</code>
                </div>
            </dd>
        </div>
        <div>
            <dt><code>include</code></dt>
            <dd>
                <div class="dddesc">
                    Copies the contents of an external file and pastes it
                    right where the command is. Takes one argument: the file itself, which is relative to CWD.
                </div>
                <div class="arguments">
                    <b>Arguments</b>: <ul>
                        <li>File path.</li>
                    </ul>
                </div>
                <div class="example">
                    <b>Example</b>: <code>{{ verbatim: {{ include: chapters/001.html }}}}</code>
                </div>
            </dd>
        </div>
        <div>
            <dt><code>verbatim</code></dt>
            <dd>
                <div class="dddesc">
                    Pastes a piece of text into the document as-is.
                    Useful for escaping preprocessor commands, as is shown here
                    in this document.
                </div>
                <div class="arguments">
                    <b>Arguments</b>: <ul>
                        <li>The raw string to paste in.</li>
                    </ul>
                </div>
                <div class="example">
                    <b>Example</b>: <code>{{ verbatim: {{ verbatim: {{ include: chapters/999.html }} }}}}</code>
                </div>
            </dd>
        </div>
    </dl>

    <h4 id="optcmds">Optional commands</h4>

    <p>
        There are also optional commands, meaning you need to have something
        else installed to be able to use them.
    </p>

    <h5 id="citeproccmds">Citeproc</h5>

    <p>
        The following commands require <a href="https://github.com/brechtm/citeproc-py">citeproc-py</a> to be installed in the current Python environment. Additionally, the <a href="https://pypi.org/project/toml/">toml</a> library must also be installed to load Citeproc sources.
    </p>

    <dl class="commands">
        <div>
            <dt><code>add sources from</code></dt>
            <dd>
                <div class="dddesc">
                    Includes all Citeproc entries from a folder. These
                    entries should be in TOML format. Example entries:
                    <details>
                        <summary>Conference paper</summary>
                        <pre>
{{ include: include_samples/ordonez16.toml }}
                        </pre>
                    </details>
                    <details>
                        <summary>Website</summary>
                        <pre>
{{ include: include_samples/trivium.toml }}
                        </pre>
                    </details>
                </div>
                <div class="pkgreqs">
                    <b>Package requirements</b>:
                    <ul>
                        <li>toml</li>
                        <li>citeproc-py</li>
                    </ul>
                </div>
                <div class="arguments">
                    <b>Arguments</b>:
                    <ul>
                        <li>Folder to include</li>
                    </ul>
                </div>
                <div class="example">
                    Example: <code>{{ verbatim: {{ add sources from: bibliography/ }}}}</code>
                </div>
            </dd>
        </div>

        <div>
            <dt><code>use citation styles from</code></dt>
            <dd>
                <div class="dddesc">
                    Sets the citation style from
                    a file or a built-in e.g. "harvard1". <em>Can only be
                    set once!</em>
                </div>
                <div class="warning">
                    <b>Warning</b>:
                    Must be used after the <code>add sources from</code> command! 
                </div>
                <div class="pkgreqs">
                    <b>Package requirements</b>:
                    <ul>
                        <li>citeproc-py</li>
                    </ul>
                </div>
                <div class="arguments">
                    <b>Arguments</b>:
                    <ul>
                        <li>File to load the CSL style from or a built-in</li>
                    </ul>
                </div>
                <div class="example">
                    Example: <code>{{ verbatim: {{ use citation styles from: citation_styles/ieee.csl }}}}</code>
                </div>
            </dd>
        </div>

        <div>
            <dt><code>ref</code></dt>
            <dd>
                <div class="dddesc">
                    Print out one or more citations in the specified format
                    into the document.
                </div>
                <div class="warning">
                    <b>Warning</b>:
                    Must be used after the <code>add sources from</code> and <code>use citation styles from</code> command!
                </div>
                <div class="pkgreqs">
                    <b>Package requirements</b>:
                    <ul>
                        <li>citeproc-py</li>
                    </ul>
                </div>
                <div class="arguments">
                    <b>Arguments</b>:
                    <ul>
                        <li>Citation IDs, if multiple separated by commas</li>
                    </ul>
                </div>
                <div class="example">
                    Example: <code>{{ verbatim: {{ ref: anon07, davie88 }}}}</code>
                </div>
            </dd>
        </div>

        <div>
            <dt><code>table of references</code></dt>
            <dd>
                <div class="dddesc">
                    Places a table of references (also known as the
                    bibliography) for the document.
                </div>
                <div class="warning">
                    <b>Warning</b>:
                    Must be used after the <code>add sources from</code> and <code>use citation styles from</code> command! Additionally,
                    at least one <code>ref</code> command must be used for the
                    output to be meaningful.
                </div>
                <div class="pkgreqs">
                    <b>Package requirements</b>:
                    <ul>
                        <li>citeproc-py</li>
                    </ul>
                </div>
                <div class="arguments">
                    <b>Arguments</b>: None
                </div>
                <div class="example">
                    Example: <code>{{ verbatim: {{ table of references: }}}}</code>
                </div>
            </dd>
        </div>
    </dl>

    <h5 id="pumlcmds">PlantUML</h5>
    <p>
        The preprocessor also supports embedding PlantUML files using the
        <code>uml</code> command. It requires the <a href="https://plantuml.com/">PlantUML</a> binary to be installed on your system. It does not require any additional Python packages to be installed.
    </p>
    <dl class="commands">
        <div>
            <dt><code>uml</code></dt>
            <dd>
                <div class="dddesc">
                    Renders a PlantUML diagram file using an external PlantUML process. The file is relative to CWD.
                    The output will be UML in the form of an <em>inlined</em> SVG image.
                </div>
                <div class="warning">
                    <b>Warning</b>: Ensure that the <code>plantuml</code> binary
                    is available in PATH before using this
                    command!
                </div>
                <div class="arguments">
                    <b>Arguments</b>:
                    <ul>
                        <li>The file to render as a UML diagram.</li>
                    </ul>
                </div>
                <div class="example">
                    <b>Example</b>: <code>{{ verbatim: {{ uml: diagrams/activity.uml }} }}</code>
                </div>
            </dd>
        </div>
    </dl>

    <h5 id="katexcmds">KaTeX</h5>
    <p>
        KaTeX can be used to embed mathematical formulas, through the use of
        the <a href="https://pypi.org/project/markdown-katex/">markdown-katex</a> extension. This library needs to be installed in order to use
        the following commands:
    </p>
    <dl class="commands">
        <div>
            <dt><code>formula</code></dt>
            <dd>
                <div class="dddesc">
                    Renders a mathematical formula which KaTeX supports. Use of this command may cause a slight delay when initializing the KaTeX Markdown extension.
                    It is highly recommended to use them with the <a href="https://github.com/KaTeX/KaTeX/releases">KaTeX CSS and fonts</a> for best results. Additionally, when rendering the HTML as a PDF, include them in your project and then link the CSS in the main HTML file to increase performance.
                </div>
                <div class="pkgreqs">
                    <b>Package requirements</b>:
                    <ul>
                        <li>markdown</li>
                        <li>markdown-katex</li>
                    </ul>
                </div>
                <div class="arguments">
                    <b>Arguments</b>:
                    <ul>
                        <li>The KaTeX formula file to render inline.</li>
                    </ul>
                </div>
                <div class="example">
                    <b>Example</b>: <code>{{ verbatim: {{ formula: math/matxmul.katex }} }}</code>
                </div>
            </dd>
        </div>
    </dl>

    <h5 id="matplotlibcmds">Matplotlib</h5>
    <p>
        <a href="https://matplotlib.org/">Matplotlib</a> can be used to render
        out graphs.
    </p>
    <dl class="commands">
        <div>
            <dt><code>formula</code></dt>
            <dd>
                <div class="dddesc">
                    Renders a graph from a Python script. The program operates
                    on a variable called <code>plt</code>. An example program is as follows:
                    <details>
                        <summary>Graph program</summary>
                        <pre>
{{ include: include_samples/sample.matplotlib.py }}
                        </pre>
                    </details>
                </div>
                <div class="pkgreqs">
                    <b>Package requirements</b>:
                    <ul>
                        <li>matplotlib</li>
                    </ul>
                </div>
                <div class="arguments">
                    <b>Arguments</b>:
                    <ul>
                        <li>The Python script to execute and render as an inline SVG graph.</li>
                    </ul>
                </div>
                <div class="example">
                    <b>Example</b>: <code>{{ verbatim: {{ graph: graphs/random.matplotlib.py }} }}</code>
                </div>
            </dd>
        </div>
    </dl>
</section>